<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<title>~/Dancer-Plugin-FormValidator/lib/Dancer/Plugin/FormValidator.pm.html</title>
<meta name="Generator" content="Vim/7.3">
<meta name="plugin-version" content="vim7.3_v6">
<meta name="syntax" content="perl">
<meta name="settings" content="use_css,number_lines">
<style type="text/css">
<!--
pre { font-family: monospace; color: #ffff00; background-color: #000000; }
body { font-family: monospace; color: #ffff00; background-color: #000000; }
.lnr { color: #00ff00; }
.Number { color: #00ffff; font-weight: bold; }
.String { color: #00ff00; font-weight: bold; }
.Identifier { color: #ff6060; font-weight: bold; }
.Comment { color: #00ff00; }
.Type { color: #ffffff; font-weight: bold; }
.Statement { color: #8080ff; font-weight: bold; }
-->
</style>
</head>
<body>
<pre>
<span class="lnr">  1 </span><span class="Statement">package</span><span class="Type"> Dancer::Plugin::FormValidator</span>;
<span class="lnr">  2 </span>
<span class="lnr">  3 </span><span class="Statement">use strict</span>;
<span class="lnr">  4 </span><span class="Statement">use warnings</span>;
<span class="lnr">  5 </span><span class="Statement">use </span>Dancer::Plugin;
<span class="lnr">  6 </span><span class="Statement">use </span>Dancer::Error;
<span class="lnr">  7 </span><span class="Statement">use </span>Data::FormValidator;
<span class="lnr">  8 </span>
<span class="lnr">  9 </span><span class="Comment">=head1 NAME</span>
<span class="lnr"> 10 </span>
<span class="lnr"> 11 </span><span class="Comment">Dancer::Plugin::FormValidator - easy validates user input (usually from an HTML form) </span>
<span class="lnr"> 12 </span><span class="Comment">based on input profile for Dancer applications.</span>
<span class="lnr"> 13 </span>
<span class="lnr"> 14 </span><span class="Comment">=cut</span>
<span class="lnr"> 15 </span>
<span class="lnr"> 16 </span><span class="Statement">our</span> <span class="Identifier">$VERSION</span> = <span class="String">'</span><span class="String">0.1</span><span class="String">'</span>;
<span class="lnr"> 17 </span>
<span class="lnr"> 18 </span><span class="Statement">my</span> <span class="Identifier">$settings</span> = plugin_setting;
<span class="lnr"> 19 </span>
<span class="lnr"> 20 </span>register <span class="String">error</span> =&gt; <span class="Statement">sub </span>{
<span class="lnr"> 21 </span>    <span class="Statement">my</span> ( <span class="Identifier">$profil</span>, <span class="Identifier">$input_hash</span> ) = <span class="Identifier">@_</span>;
<span class="lnr"> 22 </span>
<span class="lnr"> 23 </span>    <span class="Statement">my</span> <span class="Identifier">$dfv</span> = Data::FormValidator-&gt;new(<span class="Identifier">$settings</span><span class="Identifier">-&gt;{</span><span class="String">profil_file</span><span class="Identifier">}</span>);
<span class="lnr"> 24 </span>
<span class="lnr"> 25 </span>    <span class="Statement">my</span> <span class="Identifier">$results</span> = <span class="Identifier">$dfv</span><span class="Identifier">-&gt;check</span>(<span class="Identifier">$input_hash</span>, <span class="Identifier">$profil</span>);
<span class="lnr"> 26 </span>
<span class="lnr"> 27 </span>    <span class="Statement">if</span> ( <span class="Identifier">$results</span><span class="Identifier">-&gt;has_invalid</span> || <span class="Identifier">$results</span><span class="Identifier">-&gt;has_missing</span> ) {
<span class="lnr"> 28 </span>        <span class="Statement">my</span> <span class="Identifier">@errors</span> = <span class="Statement">keys</span>(<span class="Identifier">%{$results</span><span class="Identifier">-&gt;{</span><span class="String">missing</span><span class="Identifier">}</span><span class="Identifier">}</span>);
<span class="lnr"> 29 </span>        <span class="Statement">my</span> <span class="Identifier">$string</span>;
<span class="lnr"> 30 </span>
<span class="lnr"> 31 </span>        <span class="Statement">if</span> ( <span class="Statement">scalar</span>(<span class="Identifier">@errors</span>) == <span class="Number">1</span> ) {
<span class="lnr"> 32 </span>            <span class="Identifier">$string</span> = <span class="String">&quot;</span><span class="Identifier">$settings</span><span class="Identifier">-&gt;{</span><span class="String">msg</span><span class="Identifier">}-&gt;{</span><span class="String">single</span><span class="Identifier">}</span><span class="String"> </span><span class="Identifier">@errors</span><span class="String">&quot;</span>;
<span class="lnr"> 33 </span>        }
<span class="lnr"> 34 </span>        <span class="Statement">else</span> {
<span class="lnr"> 35 </span>            <span class="Identifier">$string</span> = <span class="String">&quot;</span><span class="Identifier">$settings</span><span class="Identifier">-&gt;{</span><span class="String">msg</span><span class="Identifier">}-&gt;{</span><span class="String">several</span><span class="Identifier">}</span><span class="String"> </span><span class="Identifier">@errors</span><span class="String">&quot;</span>;
<span class="lnr"> 36 </span>        }
<span class="lnr"> 37 </span>
<span class="lnr"> 38 </span>        <span class="Statement">my</span> <span class="Identifier">$error_params</span> = {
<span class="lnr"> 39 </span>            <span class="String">code</span>    =&gt; <span class="Number">500</span>,
<span class="lnr"> 40 </span>            <span class="String">message</span> =&gt; <span class="Identifier">$string</span>
<span class="lnr"> 41 </span>        };
<span class="lnr"> 42 </span>
<span class="lnr"> 43 </span>        <span class="Identifier">$error_params</span><span class="Identifier">-&gt;{</span><span class="String">title</span><span class="Identifier">}</span> = <span class="Identifier">$settings</span><span class="Identifier">-&gt;{</span><span class="String">msg</span><span class="Identifier">}-&gt;{</span><span class="String">title</span><span class="Identifier">}</span>
<span class="lnr"> 44 </span>            <span class="Statement">if</span> <span class="Identifier">$settings</span><span class="Identifier">-&gt;{</span><span class="String">msg</span><span class="Identifier">}-&gt;{</span><span class="String">title</span><span class="Identifier">}</span>;
<span class="lnr"> 45 </span>
<span class="lnr"> 46 </span>        <span class="Statement">my</span> <span class="Identifier">$dancer_error</span> = Dancer::Error-&gt;new(<span class="Identifier">$error_params</span>);
<span class="lnr"> 47 </span>        Dancer::Response::set(<span class="Identifier">$dancer_error</span><span class="Identifier">-&gt;render</span>);
<span class="lnr"> 48 </span>    }
<span class="lnr"> 49 </span>
<span class="lnr"> 50 </span>    <span class="Statement">return</span> <span class="Number">0</span>;
<span class="lnr"> 51 </span>};
<span class="lnr"> 52 </span>
<span class="lnr"> 53 </span>register_plugin;
<span class="lnr"> 54 </span>
<span class="lnr"> 55 </span><span class="Comment">=head1 SYNOPSIS</span>
<span class="lnr"> 56 </span>
<span class="lnr"> 57 </span><span class="Comment">    use Dancer;</span>
<span class="lnr"> 58 </span><span class="Comment">    use Dancer::Plugin::FormValidator;</span>
<span class="lnr"> 59 </span>
<span class="lnr"> 60 </span><span class="Comment">    get '/contact/form' =&gt; sub {</span>
<span class="lnr"> 61 </span><span class="Comment">        my $input_hash = {</span>
<span class="lnr"> 62 </span><span class="Comment">            Name    = $params-&gt;{name};</span>
<span class="lnr"> 63 </span><span class="Comment">            Subject = $params-&gt;{subject};</span>
<span class="lnr"> 64 </span><span class="Comment">            Body    = $params-&gt;{body};</span>
<span class="lnr"> 65 </span><span class="Comment">        };</span>
<span class="lnr"> 66 </span>
<span class="lnr"> 67 </span><span class="Comment">        my $error = error( 'profil_contact', $input_hash );</span>
<span class="lnr"> 68 </span>
<span class="lnr"> 69 </span><span class="Comment">        if ( ! $error ) {</span>
<span class="lnr"> 70 </span><span class="Comment">            #the user provided complete and validates</span>
<span class="lnr"> 71 </span><span class="Comment">            # data it's cool to proceed</span>
<span class="lnr"> 72 </span><span class="Comment">        }</span>
<span class="lnr"> 73 </span><span class="Comment">    };</span>
<span class="lnr"> 74 </span><span class="Comment">    </span>
<span class="lnr"> 75 </span><span class="Comment">    dance;</span>
<span class="lnr"> 76 </span>
<span class="lnr"> 77 </span>
<span class="lnr"> 78 </span><span class="Comment">=head1 DESCRIPTION</span>
<span class="lnr"> 79 </span>
<span class="lnr"> 80 </span><span class="Comment">Provides an easy validates user input based on input profile (Data::FormValidator)</span>
<span class="lnr"> 81 </span><span class="Comment">keyword within your L&lt;Dancer&gt; application.</span>
<span class="lnr"> 82 </span>
<span class="lnr"> 83 </span><span class="Comment">=head1 CONFIGURATION</span>
<span class="lnr"> 84 </span>
<span class="lnr"> 85 </span><span class="Comment">     plugins:</span>
<span class="lnr"> 86 </span><span class="Comment">         FormValidator:</span>
<span class="lnr"> 87 </span><span class="Comment">             profil_file: '/path/to/profiles.pl'</span>
<span class="lnr"> 88 </span><span class="Comment">             msg: </span>
<span class="lnr"> 89 </span><span class="Comment">                 single: 'Missing field'</span>
<span class="lnr"> 90 </span><span class="Comment">                 several: 'Missing fields'</span>
<span class="lnr"> 91 </span><span class="Comment">                 title: 'Page title'</span>
<span class="lnr"> 92 </span>
<span class="lnr"> 93 </span><span class="Comment">=head1 AUTHOR</span>
<span class="lnr"> 94 </span>
<span class="lnr"> 95 </span><span class="Comment">Natal Ngétal, C&lt;&lt; &lt;hobbestigrou@erakis.im&gt; &gt;&gt;</span>
<span class="lnr"> 96 </span>
<span class="lnr"> 97 </span><span class="Comment">=head1 CONTRIBUTING</span>
<span class="lnr"> 98 </span>
<span class="lnr"> 99 </span><span class="Comment">This module is developed on Github at:</span>
<span class="lnr">100 </span>
<span class="lnr">101 </span><span class="Comment">L&lt;<a href="http://github.com/hobbestigrou/Dancer-Plugin-FormValidator">http://github.com/hobbestigrou/Dancer-Plugin-FormValidator</a>&gt;</span>
<span class="lnr">102 </span>
<span class="lnr">103 </span><span class="Comment">Feel free to fork the repo and submit pull requests</span>
<span class="lnr">104 </span>
<span class="lnr">105 </span><span class="Comment">=head1 ACKNOWLEDGEMENTS</span>
<span class="lnr">106 </span>
<span class="lnr">107 </span><span class="Comment">Alexis Sukrieh</span>
<span class="lnr">108 </span>
<span class="lnr">109 </span><span class="Comment">=head1 BUGS</span>
<span class="lnr">110 </span>
<span class="lnr">111 </span><span class="Comment">Please report any bugs or feature requests in github.</span>
<span class="lnr">112 </span>
<span class="lnr">113 </span><span class="Comment">=head1 SUPPORT</span>
<span class="lnr">114 </span>
<span class="lnr">115 </span><span class="Comment">You can find documentation for this module with the perldoc command.</span>
<span class="lnr">116 </span>
<span class="lnr">117 </span><span class="Comment">    perldoc Dancer::Plugin::Database</span>
<span class="lnr">118 </span>
<span class="lnr">119 </span><span class="Comment">=head1 LICENSE AND COPYRIGHT</span>
<span class="lnr">120 </span>
<span class="lnr">121 </span><span class="Comment">Copyright 2010 Natal Ngétal.</span>
<span class="lnr">122 </span>
<span class="lnr">123 </span><span class="Comment">This program is free software; you can redistribute it and/or modify it</span>
<span class="lnr">124 </span><span class="Comment">under the terms of either: the GNU General Public License as published</span>
<span class="lnr">125 </span><span class="Comment">by the Free Software Foundation; or the Artistic License.</span>
<span class="lnr">126 </span>
<span class="lnr">127 </span><span class="Comment">See <a href="http://dev.perl.org/licenses/">http://dev.perl.org/licenses/</a> for more information.</span>
<span class="lnr">128 </span>
<span class="lnr">129 </span><span class="Comment">=head1 SEE ALSO</span>
<span class="lnr">130 </span>
<span class="lnr">131 </span><span class="Comment">L&lt;Dancer&gt;</span>
<span class="lnr">132 </span><span class="Comment">L&lt;Data::FormValidator&gt;</span>
<span class="lnr">133 </span>
<span class="lnr">134 </span><span class="Comment">=cut</span>
<span class="lnr">135 </span>
<span class="lnr">136 </span><span class="Number">1</span>;
</pre>
</body>
</html>
